<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>任务日志列表</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="resource/admin/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="resource/admin/plugins/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="resource/admin/plugins/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <!-- jvectormap -->
    <link rel="stylesheet" href="resource/admin/plugins/jvectormap/jquery-jvectormap-1.2.2.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="resource/admin/plugins/datatables/dataTables.bootstrap.css">
    <!-- Select2 -->
    <link rel="stylesheet" href="resource/admin/plugins/select2/select2.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="resource/admin/dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="resource/admin/dist/css/skins/_all-skins.min.css">

    <!-- layer ui -->
    <link rel="stylesheet" href="resource/plugins/layer-v2.1/layer/skin/layer.css">
    <link rel="stylesheet" href="resource/plugins/backtop/material-scrolltop.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="resource/plugins/cms/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="resource/plugins/cms/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        .required {
            color: red;
        }
    </style>

</head>
<body class="hold-transition skin-blue sidebar-mini">


        <!-- Main content -->
        <section class="content">

            <div class="row">
                <div class="col-md-12">
                    <div class="box box-primary collapsed-box">
                        <div class="box-header with-border">
                            <h3 class="box-title">查询条件</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                        class="fa fa-plus"></i>
                                </button>
                            </div>
                            <!-- /.box-tools -->
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">

                            <!-- form start -->
                            <form class="form-horizontal">
                                <div class="box-body">
                                    <div class="form-group">

                                        <label class="col-sm-1 control-label">任务状态：</label>
                                        <div class="col-sm-2">
                                            <select class="form-control" id="status">
                                                <option value="">全部</option>
                                                <option value="1">成功</option>
                                                <option value="2">失败</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-offset-1 col-md-10">
                                            <button type="button" class="btn btn-primary" id="searchBtn"><i
                                                    class="glyphicon glyphicon-search"></i>查询
                                            </button>
                                            <button type="reset" class="btn btn-default">&nbsp;重置&nbsp;</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- /.box-footer -->
                            </form>
                        </div>
                        <!-- /.box-body -->
                    </div>
                    <!-- /.box -->
                </div>
                <!-- /.col -->
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary box-solid">
                        <div class="box-header">
                            <h3 class="box-title">查询结果</h3>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <!-- 定义一个表格元素 -->
                            <table id="example" class="table table-striped table-bordered">
                                <thead>
                                <tr>
                                    <th>编号</th>
                                    <th>任务执行url</th>
                                    <th>url请求参数</th>
                                    <th>请求方法</th>
                                    <th>响应</th>
                                    <th>任务状态</th>
                                    <th>任务失败类型</th>
                                    <th>任务失败消息</th>
                                    <th>任务开始时间</th>
                                    <th>任务结束时间</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody></tbody>
                                <!-- tbody是必须的 -->
                            </table>
                        </div>
                        <!-- /.box-body -->
                    </div>
                    <!-- /.box -->

                </div>
                <!-- /.col -->
            </div>

        </section>
        <!-- /.content -->

<!-- ./wrapper -->

<!-- jQuery 2.2.0 -->
<script src="resource/admin/plugins/jQuery/jQuery-2.2.0.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="resource/admin/bootstrap/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="resource/admin/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="resource/admin/plugins/datatables/dataTables.bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="resource/admin/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="resource/admin/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="resource/admin/dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="resource/admin/dist/js/demo.js"></script>
<!-- layer ui -->
<script src="resource/plugins/layer-v2.1/layer/layer.js"></script>
<!-- 菜单 -->
<script src="resource/admin/menu.js"></script>
<!-- 返回顶部 -->
<script src="resource/plugins/backtop/material-scrolltop.js"></script>
<!-- Select2 -->
<script src="resource/admin/plugins/select2/select2.full.min.js"></script>
<!-- My97DatePicker -->
<script src="resource/plugins/calendar/WdatePicker.js"></script>

<!-- 全局变量 -->
<script type="text/javascript">
    var ctx = '';
</script>

<!-- 返回顶部 -->
<script>
    $(document).ready(function () {
        try {
            $('body').materialScrollTop({
                revealElement: 'header',
                revealPosition: 'bottom',
                onScrollEnd: function () {
                    console.log('Scrolling End');
                }
            });
        } catch (e) {
        }

        //Initialize Select2 Elements
        $(".select2").select2();
    });

</script>

<!-- page script -->
<script type="text/javascript" src="config/config.js"></script>
<script type="text/javascript" src="resource/common/js/page-0.1.js"></script>
<script type="text/javascript" src="resource/common/js/common.js"></script>
<script>
    $(function () {
        //load menu
        choiceMenu("job-list");

        /*分页查询开始*/
        window.page = new Page().init({
            tableId: "example",
            param: getSearchParam(),
            url: jobLogListApi,
            columns: [
                {
                    data: "id"
                },
                {
                    data: "url"
                },
                {
                    data: "requestParam"
                },
                {
                    data: "requestMethod"
                },
                {
                    data: "response",
                    defaultContent: "-"
                },
                {
                    data: "status"
                },
                {
                    data: "errorType"
                },
                {
                    data: "errorMsg",
                    defaultContent: "-"
                },
                {
                    data: "startTime"
                },
                {
                    data: "endTime"
                },
                {
                    data: "id"
                }
            ],
            columnDefs: [{
                "targets": 1,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {

                    return '<span title="点击查看" style="cursor: pointer" onclick="showMore(\''+encodeURI(data)+'\')">' + cutString(data, 25) + '</span>';
                }
            }, {
                "targets": 2,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {
                    return '<span title="点击查看" style="cursor: pointer" onclick="showMore(\''+encodeURI(data)+'\')">' + cutString(data, 30) + '</span>';
                }
            }, {
                "targets": 4,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {
                    return '<span title="点击查看" style="cursor: pointer" onclick="showMore(\''+encodeURI(data)+'\')">' + cutString(data, 30) + '</span>';
                }
            }, {
                "targets": 7,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {
                    return '<span title="点击查看" style="cursor: pointer" onclick="showMore(\''+encodeURI(data)+'\')">' + cutString(data, 30) + '</span>';
                }
            }, {
                // 定义操作列,######以下是重点########
                "targets": 5,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {
                    switch (data) {
                        case 1 :
                            return '<font color="green">成功</font>';
                        case 2 :
                            return '<font color="red">失败</font>';
                        default :
                            return '异常';

                    }
                }
            }, {
                // 定义操作列,######以下是重点########
                "targets": 6,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {
                    switch (data) {
                        case 1 :
                            return '<font color="#a52a2a">内部错误</font>';
                        case 2 :
                            return '<font color="#008b8b">外部错误</font>';
                        default :
                            return '<font color="green">正常</font>';;

                    }
                }
            }, {
                // 定义操作列,######以下是重点########
                "targets": 10,//操作按钮目标列
                "data": null,
                "render": function (data,
                                    type, row) {
                    var id = '"' + row.id
                        + '"';
                    var html = '';
                    /*html += "<button class='btn btn-default btn-xs'  onclick='detail("
                        + id
                        + ")'><i class='glyphicon glyphicon-info-sign'></i> 详情</button>&nbsp;";*/
                    html += "<button class='btn btn-xs btn-danger' onclick='del("
                        + id
                        + ",\"" + row.id + "\")'><i class='fa fa-times'></i> 删除</button>";
                    return html;
                }
            }]
        });

        /*分页查询结束*/

        $("#btnAddPage").click(function () {
            layer.open({
                title: ["添加产品", 'font-size:20px;'],
                type: 2,
                area: ['600px', '400px'],
                fixed: false, //不固定
                maxmin: true,
                content: './add'
            });
        });

        $("#searchBtn").click(function () {
            page.search(getSearchParam());
        });


    });

    function getSearchParam() {
        //封装查询条件
        var param = new Object();
        param.jobId = getQueryString("id");
        param.status = $("#status").val();
        return param;
    }

    function del(id, name) {
        //询问框
        layer.confirm('确定要删除『' + name + '』吗？', {
            btn: ['确定', '取消'] //按钮
        }, function () {
            var param = new Object();
            param.id = id;
            $.ajax({
                url: jobLogremoveApi,
                type: 'POST',
                data: JSON.stringify(param), //传入已封装的参数
                contentType: "application/json; charset=utf-8",
                success: function () {
                    layer.msg("删除成功");
                    page.search();
                },
                error: function (e) {
                    layer.msg("服务器繁忙");
                }
            })
        }, function () {
            layer.msg('已取消');
        });
    }


    /**
     * 查看任务日志详情
     * @param id
     */
    function detail(id) {

    }

    function showMore(data) {

        layer.open({
            type: 1,
            shadeClose: true,
            area: ['600px', '400px'],
            fixed: false, //不固定
            content: '<div style="padding: 20px;">'+decodeURI(data)+'</div>'
        });

        /*layer.alert( decodeURI(data), {
            skin: 'layui-layer-lan'
            ,closeBtn: 0
            ,anim: 4 //动画类型
        });*/
    }

</script>
</body>
</html>
